library(rvest)
library(dplyr)
url <- "https://nashp.org/state-laws-passed-to-address-health-system-costs-2020-2024/"
page <- read_html(url)
# If itâ€™s a proper <table> tag:
laws_tbl <- page %>%
html_element("table") %>%
html_table(fill = TRUE)
library(rvest)
library(jsonlite)
library(dplyr)
library(purrr)
library(stringr)
url <- "https://nashp.org/state-laws-passed-to-address-health-system-costs-2020-2024/"
page <- read_html(url)
# pull ALL script tags
scripts <- page %>% html_elements("script") %>% html_text()
# find the script that contains JSON (NASHP uses "var states" or similar)
json_script <- scripts[str_detect(scripts, "\\{.*\\}")][1]
json_script
library(rvest)
library(jsonlite)
library(dplyr)
library(purrr)
library(stringr)
url <- "https://nashp.org/state-laws-passed-to-address-health-system-costs-2020-2024/"
page <- read_html(url)
# pull ALL script tags
scripts <- page %>% html_elements("script") %>% html_text()
# find the script that contains JSON (NASHP uses "var states" or similar)
json_script <- scripts[str_detect(scripts, "\\{.*\\}")][1]
json_script
json_text <- str_extract(json_script, "\\{.*\\}")
data <- jsonlite::fromJSON(json_text)
str(data)
scripts <- page %>% html_elements("script") %>% html_text()
scripts[1:10]
library(rvest)
library(dplyr)
url <- "https://nashp.org/state-laws-passed-to-address-health-system-costs-2020-2024/"
page <- read_html(url)
# Select the dynamic table directly by CSS class
laws_tbl <- page %>%
html_element("table.igc-table__dynamic") %>%
html_table(fill = TRUE)
library(rvest)
page <- read_html("laws_table.html")
laws_tbl <- page %>% html_table(fill = TRUE)
View(laws_tbl)
## upload and normalize NASHP data
library(readxl)
library(janitor)
library(dplyr)
library(purrr)
nashp_raw <- "/data/raw/state_mandates/NASHP_leg_tracking.xlsx"
sheets <- excel_sheets(nashp_raw)
## upload and normalize NASHP data
library(readxl)
library(janitor)
library(dplyr)
library(purrr)
nashp_raw <- "data/raw/state_mandates/NASHP_leg_tracking.xlsx"
sheets <- excel_sheets(nashp_raw)
combined_df <- sheets %>%
map_df(~ read_excel(nashp_raw, sheet = .x) %>%
clean_names() %>%        # normalize headers (snake_case)
mutate(source_sheet = .x)  # optional: keep which sheet it came from
)
glimpse(combined_df)
#@ write it
write.csv(combined_df, "nashp_combined_clean.csv", row.names = FALSE)
## KFF data
library(httr)
library(readxl)
library(janitor)
library(dplyr)
url <- "https://www.kff.org/wp-content/themes/ksgf/assets/static/data/export-custom-report.xlsx"
dest <- "kff_custom.xlsx"
GET(url, write_disk(dest, overwrite = TRUE))
kff_raw <- read_excel(dest) %>%
clean_names()
## KFF data
library(httr)
library(readxl)
library(janitor)
library(dplyr)
url <- "https://www.kff.org/state-health-facts/custom-state-report/?i=452936%7C49be6ebc~127996%7Cfa638525~213017%7Cfa638525~254282%7Cfa638525~242275%7Cc09e6cc0~206104%7Cc09e6cc0~206560%7Cc09e6cc0~206106%7Cc09e6cc0~206073%7Cc09e6cc0~206061%7Cc09e6cc0~32092%7C70f525ff~32093%7C70f525ff~32094%7C70f525ff~32095%7C70f525ff~32355%7C89ff9d13~32357%7C89ff9d13~32356%7C89ff9d13~448881%7C89ff9d13&g=al~ak~az~ar~ca~co~ct~de~dc~fl~ga~hi~id~il~in~ia~ks~ky~la~me~md~ma~mi~mn~ms~mo~mt~ne~nv~nh~nj~nm~ny~nc~nd~oh~ok~or~pa~ri~sc~sd~tn~tx~ut~vt~va~wa~wv~wi~wy&view=3"
dest <- "kff_custom.xlsx"
GET(url, write_disk(dest, overwrite = TRUE))
kff_raw <- read_excel(dest) %>%
clean_names()
